#lang sicp

(define (square m)  
  (display "square ")(display m)(newline) 
  (* m m))

(define (fast-expt b n)
  (cond ((= n 0) 
         1)
        ((even? n) 
         (square (fast-expt b (/ n 2))))
        (else 
         (* b (fast-expt b (- n 1))))))

(define (expmod base exp m)
  (cond ((= exp 0) 1)
        ((even? exp)
         (remainder 
          (square (expmod base (/ exp 2) m))
          m))
        (else
         (remainder 
          (* base (expmod base (- exp 1) m))
          m))))

(define (expmod2 base exp m)
  (remainder (fast-expt base exp) m))


(expmod 7 10003 103)
(display "_________________________________\n")
(expmod2 7 10003 103)

; It seems scheme can handle arbitrarily large numbers
; But it would be much slower to compute with large numbers

;square 7
;square 49
;square 32
;square 61
;square 91
;square 81
;square 72
;square 34
;square 23
;square 98
;square 25
;square 7
;square 34
;58
;_________________________________
;square 7
;square 49
;square 2401
;square 40353607
;square 11398895185373143
;square 909543680129861140820205019889143
;square 827269706064171159838078900184013751038269841857389464208009274449
;square 684375166571500149069971016475029073861656567929830694323100654407833221808533066171413712544046001452274401914981868928799404253601
;square 468369368619768575104184740417572608245012033553022573556919190707099653961343279534028489793804429888437205802831006346377129887699848664008159963728009251254297978342734145733304298792558794049091167060245498322168012990372683549141401164310755180131371921467201
;square 1535589058228964592278097181151415909200385800452495618150720642558740272322299488400821914700875797183165562794910089618874549353298389638535468977632311792677723234363039812929990798224753440087824188191010805346435998749996092640979530974424855611373502186548925391038652857840156250967512563069982941255640478823554939640561443613796856865588141056286824186637033949488464663290280364476539987909480558828315138852768523111975503843351865420654483184799794043499337516602578703543161331291559200663108824166410988611631420807
;square 2358033755752518409195779433390591502065174039015961638174069064234711050680710919879881007137759026969377976631259971502132338271308634749032648608226378328373626180446396450852539781378616340175506271745829836534902606253809908324868658708395461580705325486481796044105044455974682948232846179955413680547264413568668716375022576570287906863129469616510734012123921078154122165008549705011538927807105358796231697423234774092144310991788249645197288660157034424683790075596184997127951742573307528702897695041679062914766514438516076790210559070889805143790846050808199947698533558248227030025219446132229558245643487280146818997237165460262125735194137304920980647158732219541580465206985563800873822016458809791940467371385620140375658272441861912527121544508227820542735768997409263235331202088514023842856042846559750507019190446793576673421128494920252485026709728423849136438059823093165228296244620679255671466714019464086496743309810059519705723218526759211004061943226607051640069181928500009897964895329670269774276258324366766249550389512531249
;square 5560323193268327645851384571118124259070013559843400072266331519756250585429801843030312870464856835860935463870678518907567943433790111816344810370399070402127950492941825534663901707479662445746955629630771705567305673479985121745387020054336964127464548077908768640464952232170404717820454363350466532333653014590802770991108240476923191547403090862931974387130597229393191628157569168759298498562990651298411663410033465861230400336159410795992642435492148927705653068381565694052554945413593588424675352591570387518354191804727784318182281786709013482289390959325551151852843952257128353650879893926220627730175528916526033654474829817695132139209527180053742208018894392897429935324256328357268607654677377976090025949844777438959628955006605499104156978650490918590952839931042158408214440071492343363634659244585328942139955711271512376675611291925068041199495166772431315783253405475945364262407016047164164551225743790161147402616543244642165438853949203050158481969040951844118104896666274564273580041287705412697924033035865862423742756420658580971784182630665606563418254695653312029777730526044381181377321846348236459519886344023667236073262254509711558501283424568582090545868798158122329755649730011593322076636059667054327085145807146415013396834085184394866530148261647397021876993830829335102450138599093031214083982656555726315570996021380565195851415190887222135497831317909636009342207733586797336271308243566389882111927804252100516316094840215181274908808030784469970768343735640955034741997805999360708087339518224561959356727049094903307605556935966513000358697677479521531638159667560431014947178732254608090185072183638290939750845081795380657068262167604782667965593989480962494680604231968143409955236723204552296924678288446564214090401108479870256460358864354899247138428055841610136087621454643525780597142506054427539104486316869388737696726296109554862849740795519854625035305496271914282577937486377985197680987701512935465845764416051745720382655925223090329631488176801850617488423653077885530181033840102604483623301262552048560053072702830288036329997534387900003201500001
;square 216420358095183844799211612146003522062559566111821231667996776989789675142403112133085878970049055252118842082066401047238028228115240910915832456051936359204980163061641091776075287688821866918514173661160798817804927283023109439942852940283906201504361511812165854901272192055948454844472452872875665700858392686022076319514078787774885465036632366081119678814521655613809384501333540959565381764768313358688209883940890270162304560831123173348781589864099408981729206003889682693357452715293713246811596527243805259233597054885367721786874546155802677599744151248932698223315823846817492597307266281665650236907210825559374558074519701054064468787081106975370403325040594293293973773178753378540334733469833443973756694534949107787351738793570012463315148605468198797459012237314267249454599016023095599771512331767617152727446413133201925055874289571333734853673007397644258709760140124161378952603629929445284016815308658920843689476282176648630959313679978032863936367419716388660513758564152354441804242348876063739262901033513316887889829750117664468204046944524520803840344982258060780182814889996306339913246457463779568367490066380214259491963629547231802685727700110695708650502368039032101275930412759805983813492302316709092421724180718974398007301778033349633971588474796763259671951607874817399418565164434226832366988002894116361709221062329257463096962676989715975932117596248039886898027598873785377739443693132020076316200758729288028727167169278358825097651274938549114577501271938350529382910331096789504618926689735370094259468394193201789865443557548678150708440347611518263675068160636687147055354806280350589619351626821261934210620781690394713394245537987184732678453613413705770205649044545111394355141659942881049114918935022768985862732298206820964334160149986137156706687675630071608329219958538088848118117296321510382171203131238688258895118813501836446046118157107699666685816905435463188489064923652487393215729909094760313934303770741560055582349118538100760475368533825494803384598678200464767295610013467785790033919933587508029867615408960754658043589972244108327551611018655618833147640745626494719556596793907245742300431028194583490147525271904275035049585930587660597137033774701772810034691846479364677459994031487954655064191546185283578213325056333501673219932098672818951837766001256506234460455474527866515504187938872626930804049592384793069320594569233706913788128452215235648221169253786737063592829684194870637317664275319022408498386255676559489604172704596176500440519360521101093233748254655834655826066348133652457330484764582095338881696833928422218031161599870090126833550478582744296076332018128995363361950862443630629407695887989295643874922398461267582786925111793908955865631676266113434886434068566007459463829683439603672899220768873923711196368504849866772914336033931575101802171598894682837323069928846551268063897935703182179028048854523728228533251161271201995651677874348968337372280705911835099154869908883695643315722462173054808580854213920556399084198725743198104402113466911976857465359029897127769026919107885761465972828322285793485855314282056794086067732532985817539958066962325127515631293199402999253488091664190506193273569522346918897303734098869087792848215531332717998298340667627473494919284139877740387873488655614965608549226825968982785865800599482925052929940078219627620933580419963306896769178866961500206483622123469889992264935917390439846250980936098709205233902940950203887470737780018531315271349178432101793775592392769664866866204713072026409948425906549655415295475606845667270152461203387585731305304979315860319602384246361810624792151569242925531950999599473760550487322686128260320088310520443480485026683215802474999884259833045001478251359225758764757825493154070281201356700695539789298622679252387581811582676334829905875385336441248571541961833294138792134842413731877180330516300283014932877999014075181033087073363171254216464539547257941238716695391995166779369610938835809810964314793481937841758010277273092400203038283269506161412832444213301951666870827052434426932027080956565454653198546205122560750836364186075683501128873416402063844801065551662902092075747407515610617164516867420031453177815794821000007
;58
